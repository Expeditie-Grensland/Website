extends ../members/_frame
include ../_expeditieMedia

block title
    title Expeditie - Admin - Bestanden

block content
    .row
        .col-12.mb-4
            .h1 Bestanden

        if errMsgs.length + infoMsgs.length
            .col-12.mb-4
                each msg in errMsgs
                    .alert.alert-danger= msg
                each msg in infoMsgs
                    .alert.alert-info= msg

        .col-12.mb-2
            hr
            .h2.mb-3 Nieuw bestand uploaden
            form(method='POST' action='/admin/bestanden/upload' enctype='multipart/form-data')
                .form-row.align-items-center
                    .col-12.col-md-4.mb-2.me-md-2
                        label.form-label(for='files') Kies bestanden
                        input#files.form-control(name='files' type='file' multiple accept='image/jpeg,audio/mpeg,video/mp4' required)
                    .col-auto.mb-2.me-2
                        .form-check
                            input#filesRestrict.form-check-input(name='restricted' type="checkbox")
                            label.form-check-label(for='filesRestrict') Beperk toegang
                    .col-auto.mb-2
                        button.btn.btn-primary(type='submit') Uploaden

        .col-12.mb-4
            hr
            .h2.mb-3 Bestand aanmaken in database zonder uploaden
            p Vereist handmatige upload van het bestand met de goede naam naar de webserver onder #[code '/mnt/expeditiegrensland-media/]'
            form(method='POST' action='/admin/bestanden/add')
                .form-row.align-items-center
                    .col-auto.col-md-4.mb-2.me-2
                        select.form-select(name='mime' required)
                            option(selected value='' disabled) Mime type
                            option(value="image/jpeg") image/jpeg
                            option(value="audio/mpeg") audio/mpeg
                            option(value="video/mp4") video/mp4
                    .col-auto.mb-2.me-2
                        .col-auto.mb-2.me-2
                            .form-check
                                input#mimeRestrict.form-check-input(name='restricted' type="checkbox")
                                label.form-check-label(for='mimeRestrict') Beperk toegang
                    .col-auto.mb-2
                        button.btn.btn-primary(type='submit') Toevoegen

        .col-12.mb-4
            hr
            .h2.mb-3 Bestaande bestanden aanpassen
            table.table.table-sticky-header
                thead
                    tr
                        th(style='min-width: 15rem;') Id
                        th(style='min-width: 5rem;') Extensie
                        th(style='min-width: 7.5rem;') Mime
                        th(style='min-width: 7.5rem;') Toegang
                        th(style='min-width: 15rem;') Preview
                        th

                tbody
                    each file, i in files
                        tr
                            td= file._id.toHexString()
                            td= file.ext
                            td= file.mime
                            td= file.restricted ? "Beperkt" : "Niet beperkt"
                            td.media-preview
                                +mediaFilePlayer(file)
                            td
                                form.form-confirm(id=`f-${i}` method='POST' action=`/admin/bestanden/edit`)
                                    input(type='hidden' name='id' value=file._id.toHexString())
                                    button.btn.btn-danger(type='submit' name='action' value='delete') Verwijderen
